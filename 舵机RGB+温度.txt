//舵机0 绿色
//舵机45 黄色

#include <MeMCore.h>

// 初始化温度传感器
MeTemperature temperatureSensor(PORT_1); // 假设温度传感器连接到PORT_3（A0）

// RGB LED灯
MeRGBLed led(PORT_2, 4); // 初始化RGB LED灯，指定数量为4

// 舵机
MePort port(PORT_1);
Servo myservo1; // 创建控制舵机的舵机对象
int16_t servo1pin = port.pin1(); // 将舵机连接到PORT_1的SLOT1

unsigned long startTime;  // 记录程序开始的时间

void setLEDColor(uint8_t red, uint8_t green, uint8_t blue) {
  for(uint8_t t = 0; t < 4; t++) { // 遍历4个LED灯
    led.setColorAt(t, red, green, blue); // 设置每个LED灯的颜色
  }
  led.show();
}

void setup() {
  // 初始化串口通信
  Serial.begin(9600);

  // 初始化LED灯
  led.show();

  // 初始化舵机
  myservo1.attach(servo1pin);

  // 记录程序开始的时间
  startTime = millis();
}

void loop() {
  // 获取当前时间
  unsigned long currentTime = millis();
  
  // 程序运行时间超过10秒则停止
  if (currentTime - startTime > 10000) {
    return;
  }

  // 读取温度值
  float temperature = temperatureSensor.temperature();

  // 输出温度值
  Serial.print("Temperature: ");
  Serial.print(temperature);
  Serial.println(" C");

  // 控制舵机并输出角度值
  setLEDColor(255, 255, 0); // 设置LED灯为黄色表示舵机正在运动
  myservo1.write(0);      // 设置舵机1的位置为0度
  Serial.println("Servo 1 Angle: 0 degrees");
  delay(2000);            // 等待2秒

  setLEDColor(0, 255, 0); // 设置LED灯为黄色表示舵机正在运动
  myservo1.write(45);     // 设置舵机1的位置为45度
  Serial.println("Servo 1 Angle: 45 degrees");
  delay(2000);            // 等待2秒

  setLEDColor(0, 255, 0); // 设置LED灯为绿色表示舵机不在运动
}